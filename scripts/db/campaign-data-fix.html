<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Data Fix</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Campaign Data Fix</h1>
    <p>This page will fix the campaign data issue by injecting the correct data into localStorage.</p>
    <button onclick="fixCampaignData()">Fix Campaign Data</button>
    <div id="status"></div>
    
    <script>
        const { createClient } = supabase;
        const supabaseClient = createClient(
            'https://twigokrtbvigiqnaybfy.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR3aWdva3J0YnZpZ2lxbmF5YmZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTExMzUyNjksImV4cCI6MjA2NjcxMTI2OX0.AcRI1NYcCYpRqvHZvux15kMbGPocFbvT6uLf5DD6v24'
        );
        
        async function fixCampaignData() {
            const status = document.getElementById('status');
            status.innerHTML = '<p>Fetching campaign data...</p>';
            
            // Get the test mm campaign
            const { data: campaign, error } = await supabaseClient
                .from('campaigns')
                .select('*')
                .eq('id', '372fa470-8c48-43f8-95f2-91b62e2972b9')
                .single();
                
            if (error) {
                status.innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
                return;
            }
            
            // Get counts
            const { count: leadCount } = await supabaseClient
                .from('leads')
                .select('*', { count: 'exact', head: true })
                .eq('campaign_id', campaign.id);
                
            const { count: callCount } = await supabaseClient
                .from('calls')
                .select('*', { count: 'exact', head: true })
                .eq('campaign_id', campaign.id);
            
            // Create the proper campaign object
            const campaignData = {
                id: campaign.id,
                name: campaign.name,
                status: campaign.status || 'active',
                totalLeads: leadCount || 0,
                callsCompleted: callCount || 0,
                totalCost: (callCount || 0) * 0.05,
                successRate: leadCount > 0 ? (callCount / leadCount) * 100 : 0,
                settings: {
                    ...campaign.settings,
                    total_leads: leadCount || 0,
                    calls_completed: callCount || 0
                }
            };
            
            // Store in localStorage as a temporary fix
            localStorage.setItem('campaign_' + campaign.id, JSON.stringify(campaignData));
            
            status.innerHTML = `
                <p style="color: green;">âœ… Campaign data fixed!</p>
                <p>Campaign: ${campaign.name}</p>
                <p>Leads: ${leadCount}</p>
                <p>Calls: ${callCount}</p>
                <p>Data stored in localStorage</p>
                <hr>
                <h3>Full Data:</h3>
                <pre>${JSON.stringify(campaignData, null, 2)}</pre>
            `;
        }
    </script>
</body>
</html>