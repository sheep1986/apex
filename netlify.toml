[build]
  base = ""
  publish = "dist"
  command = "corepack enable && pnpm install --frozen-lockfile && rm -rf node_modules/.cache && pnpm run build"
  environment = { CI = "true", NODE_VERSION = "20", NETLIFY_CACHE_CLEAR = "true" }

[context.staging]
  command = "pnpm run build"
  environment = { VITE_API_URL = "https://staging.trinity-platform.app" }

[dev]
  command = "pnpm run dev"
  targetPort = 5522
  port = 3333

[[redirects]]
  from = "/api/voice/webhook"
  to = "/.netlify/functions/voice-webhook"
  status = 200

[[redirects]]
  from = "/api/voice-engine-auto-setup"
  to = "/.netlify/functions/voice-engine-auto-setup"
  status = 200

[[redirects]]
  from = "/api/voice/test-call"
  to = "/.netlify/functions/voice-test-call"
  status = 200

[[redirects]]
  from = "/api/voice/calls/*"
  to = "/.netlify/functions/voice-calls"
  status = 200

[[redirects]]
  from = "/api/voice/calls"
  to = "/.netlify/functions/voice-calls"
  status = 200

[[redirects]]
  from = "/api/campaign/*"
  to = "/.netlify/functions/campaign-manager"
  status = 200

[[redirects]]
  from = "/api/bootstrap"
  to = "/.netlify/functions/bootstrap"
  status = 200

[[redirects]]
  from = "/api/make-call"
  to = "/.netlify/functions/make-call"
  status = 200

[[redirects]]
  from = "/api/onboarding/*"
  to = "/.netlify/functions/onboarding"
  status = 200

[[redirects]]
  from = "/api/*"
  to = "https://apex-backend-vercel-alh0xjd6q-seans-projects-aabd20b2.vercel.app/api/:splat"
  status = 200
  force = true

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "strict-origin-when-cross-origin"
